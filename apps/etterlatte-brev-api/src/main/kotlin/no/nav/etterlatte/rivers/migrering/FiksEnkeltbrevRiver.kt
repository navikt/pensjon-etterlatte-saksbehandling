package no.nav.etterlatte.rivers.migrering

import kotlinx.coroutines.runBlocking
import no.nav.etterlatte.brev.hentinformasjon.VedtaksvurderingService
import no.nav.etterlatte.libs.common.rapidsandrivers.eventName
import no.nav.etterlatte.libs.common.vedtak.VedtakKafkaHendelseType
import no.nav.etterlatte.rapidsandrivers.migrering.Migreringshendelser
import no.nav.etterlatte.rivers.BrevEventTypes
import no.nav.etterlatte.token.Systembruker
import no.nav.helse.rapids_rivers.JsonMessage
import no.nav.helse.rapids_rivers.MessageContext
import no.nav.helse.rapids_rivers.RapidsConnection
import org.slf4j.LoggerFactory
import rapidsandrivers.BEHANDLING_ID_KEY
import rapidsandrivers.behandlingId
import rapidsandrivers.migrering.ListenerMedLoggingOgFeilhaandtering

internal class FiksEnkeltbrevRiver(
    rapidsConnection: RapidsConnection,
    private val vedtaksvurderingService: VedtaksvurderingService,
) : ListenerMedLoggingOgFeilhaandtering(BrevEventTypes.FIKS_ENKELTBREV.toString()) {
    private val logger = LoggerFactory.getLogger(this::class.java)

    init {
        initialiserRiver(rapidsConnection, Migreringshendelser.FIKS_ENKELTBREV) {
            validate { it.requireKey(BEHANDLING_ID_KEY) }
        }
    }

    override fun haandterPakke(
        packet: JsonMessage,
        context: MessageContext,
    ) {
        val behandlingId = packet.behandlingId
        logger.info("Fikser vedtaksbrev for behandling $behandlingId")

        val brukerTokenInfo = Systembruker("migrering", "migrering")
        runBlocking {
            packet.eventName = VedtakKafkaHendelseType.ATTESTERT.toString()
            val vedtak = vedtaksvurderingService.hentVedtak(behandlingId, brukerTokenInfo)
            packet["vedtak"] = vedtak
        }
        context.publish(packet.toJson())
    }
}

/* Liste laga ved å hente alle behandlingar
where revurdering_aarsak='REGULERING' and behandling_opprettet > '2023-11-20' and status = 'IVERKSATT'
og så kontrollsjekke desse opp mot brevbasen. Alle mangla journalpost_id og bestilling_id
*/
val behandlingerAaJournalfoereBrevFor =
    listOf(
        "fe9bbee9-f288-4100-9282-1c13aae567ef",
        "fcb46b42-eaeb-4309-b64e-a299b6ef6e5b",
        "fb2960ae-9303-4503-ada4-eda4d126a9ac",
        "fadcd4c3-410d-42e3-8a58-9491aea57f76",
        "fa193750-7a89-4519-9179-369a2a9f1765",
        "f8e7b371-f2cf-444b-aa8e-2dfba5d504b9",
        "f84af936-e246-45c1-ab00-98e87ec7f524",
        "f7c252a6-e240-4fde-a33f-6809daa8e5d0",
        "f6661ed5-5044-4791-ae86-a73c5e9ab38a",
        "f520dbd0-4bfa-41d9-bf3d-1a17781fd0f6",
        "f289662e-cf32-4956-a36a-dbd986fa81bb",
        "f0f25287-f394-41da-825e-763790afe35d",
        "eddcba96-1118-44a0-92dd-efeece0ee6a0",
        "eda5f5c0-4dd0-44fc-803f-1be837852b85",
        "ed868b02-0c64-4330-8959-aec6f9e8934e",
        "ea1d0fc4-46d3-4927-afed-61dba0c4d8fe",
        "e731be7f-a1b8-4c9e-b9ec-7ff5c4133460",
        "e62b4b8d-51d8-4f26-976a-181ecc4da832",
        "e340ea33-8f9e-4a44-8cfc-3d0017d789db",
        "e333b852-ec1a-4577-b7f5-23085f9fe740",
        "e26f847f-bcf2-4ffb-9c53-df35b1e0edad",
        "e2555297-6b55-4e55-829f-4b82a141a590",
        "e23d4432-bc7f-4dac-b2b6-e0b472bc12f1",
        "e12d31b6-6d63-443e-9865-415128449e9b",
        "e0c3210b-7b87-4cc0-89df-97fceb2fb316",
        "e053607d-ac98-4e45-ab6f-63a87990e105",
        "ddc4eb0c-3ea3-4955-8c4a-5d507263045e",
        "dd57e38a-411e-4f3a-b1c4-02b246f124c1",
        "dd066361-b73e-4d65-8ef8-3d74f086ac82",
        "dcea5982-72fc-49a0-b5f7-354d503b3e10",
        "d8d522a0-fe49-4377-93e3-3a4817f965c4",
        "d7fd100b-386d-4306-af6b-7bd5bc7c045a",
        "d7b5fa65-4191-4f86-b5eb-e2fa2e2e001a",
        "d78a80ea-f350-43ef-a7a9-a5167f74fe38",
        "d6951d9e-9c7c-4bcf-87f8-608703500d90",
        "d52e5b70-3073-4fbd-a5ce-4c5833dcc4ca",
        "d3bcccfe-96c8-4823-9af8-a3f26eaf0dd7",
        "d2bf55b4-707c-4844-88f0-f9d57042f366",
        "d2b016a9-4fd9-4347-b744-72cbaf412fa9",
        "d24c19d9-e434-4dda-946a-6784b37fb590",
        "d0efd41c-7b86-4a36-9880-4131dced351f",
        "cec8426f-a90c-4dd3-b4fc-3483318a6931",
        "cdc69f15-b047-4e76-b677-7f2c912ad39a",
        "cc884487-6d30-455c-aa00-d63c313fbba5",
        "cc5a9649-9faa-4442-98d0-ba0b67515125",
        "cc5294a5-b93a-4c4b-8994-311e0a4c179f",
        "cc415383-309b-456a-a9ba-d7e2f1f0cd60",
        "cc2a2d50-75e5-4575-8395-19f296bde163",
        "ca87ef82-5b04-45b7-b808-1aa83df08c17",
        "ca49df8d-111d-4726-82f7-d4b84f9ef718",
        "c90e284d-4b08-4af0-aa64-902b91e2ecda",
        "c793fd3f-0867-46d3-b40a-ea38235af330",
        "c5047bc3-61ae-480c-b98c-8b8369384ffd",
        "c466def2-df3e-40ef-8bdc-b65738bf0cd1",
        "c3707935-5117-4c94-a504-1e941f4bf52b",
        "c3023496-21ad-4517-a86d-7a7be6e106bf",
        "c2c8b144-81fd-4ef1-b199-bb31233ff6de",
        "c26cffb1-d69c-44b7-b572-77c5f5d55d9a",
        "c2279a2c-035e-470e-94bf-058ccd9d65fa",
        "c1e0140a-2614-46f6-b016-0b44b1fd98fb",
        "bf01190e-e35d-4d46-ab3a-c0a03a1caf89",
        "bea3fb96-7857-40ab-a02a-6ae5dffc4fa8",
        "bcdd6f06-f2ef-493c-b22b-324ec33a9dff",
        "bbd600ff-c952-4aad-87ac-1383c22b4ebf",
        "bbc817a2-2d93-4f9a-9c97-81ce5ae59fdf",
        "b5c2906c-e101-4d26-9bad-7a56d635c8ee",
        "b3edabfb-9e79-41ec-bbb8-956dc0980c0c",
        "b2aceee6-db73-4a9a-ac16-ccc856ebab66",
        "ae04c4b0-e811-411f-9975-0e4bf6c8b6e2",
        "acddb02c-f983-44a8-a3ac-a00964b9f6f4",
        "aa874945-08ce-4ce2-8741-4aafdc3b2e91",
        "aa33df31-66d5-4443-8756-70e4259a4c13",
        "a81b2e2e-5b1c-4cba-bed0-b804b957f949",
        "a6f90a38-7448-4089-8fad-2a9be25379c9",
        "a60fb8cc-43e2-4054-9cfd-e12cf9a9eb2e",
        "a4d57d2e-e21c-4e67-941a-481000cee7fd",
        "a497db58-017a-4c32-811a-7971501693ad",
        "a38303fd-e73d-468c-9eec-e623716221a1",
        "9fa8f4a0-c172-413f-a324-d0dc588a08e4",
        "9f349d44-5dae-4451-9309-3ebf76ec8040",
        "9f005ab4-33ab-4959-8fe3-7a45e437d151",
        "9b5a311f-3e12-45d4-b755-cac085087ba2",
        "9a8774f5-8b77-4139-a19a-497173618ed6",
        "98b848d3-d3c2-4ce2-84c1-471595a703c1",
        "980c0a92-1f28-4699-9bf2-6d88e8e4051c",
        "965d7759-0704-4c42-9161-d853437e5bb4",
        "9522c497-1d1c-4948-a10c-486f1b59ec8b",
        "94b9b0d0-a092-4591-9290-ead5859f616d",
        "94b2ed3c-9de9-4aed-a365-02576b925c5b",
        "94ac484e-f0f6-47d2-b352-3e98bfaffb9c",
        "922d9a45-04de-4b0b-8f8b-580903f3c6a6",
        "91e1b723-6055-4a85-a39a-2eaf940ed6b2",
        "8fb798db-20bf-47a2-9424-cc945978cfec",
        "8de8c4f2-628f-4263-a6f9-9bfd365a6c2b",
        "8d1bab8d-7acf-42ef-8ba1-d94597593131",
        "8c73b8f1-6028-4e8a-8403-e191757ad40a",
        "8c4169c2-9354-45ae-9afa-62c9cf97b701",
        "8c36a319-4278-40e3-9cd9-ce6976f073b0",
        "8b39a828-534e-4d6a-8076-71a222f864e4",
        "8a5f1995-dce2-4107-bcff-24830d5d31d6",
        "895abfb0-1845-4f4f-bfa9-a2e2276231bd",
        "893b6f94-7db6-4d3f-8896-84d2738d88ec",
        "89107a15-b2c4-4565-96d0-a9eaec9592fa",
        "84dc9e83-8235-46a1-9ac1-2d7e7ef2906a",
        "84b2c7f1-8f04-498f-aee9-8fb230d060d2",
        "82f59eb9-4902-4b0c-812a-1a859edfe35a",
        "81aeb594-7488-4dc7-98db-cf0158f882e2",
        "80d90db4-044c-46b5-9d13-23e91eb4c07f",
        "7e33d75f-c55b-4c72-b2df-e5413158060b",
        "7c8a7928-98bb-490d-9fc4-0ee38b716a5a",
        "7c78044f-9854-43ef-b90c-d67bb6733405",
        "7c645f19-67b2-41ee-a2d4-ebedc431d3e6",
        "79777359-aff1-4365-bafb-7c46b6368427",
        "776be0ce-35f3-4bdc-be3e-e8026edd0575",
        "770453f3-612e-4817-b412-9da181661c63",
        "753b9712-effe-4fb9-a416-2022eb7e6e5f",
        "752fb6ef-691c-4575-816b-8d4974515a30",
        "742f9638-c27b-44c2-af9c-4b979afa18f2",
        "73c40a8f-ccf8-417a-9585-bd5f28d6e8a5",
        "732d15f0-77b4-4c9e-8b36-afc8a00ed02c",
        "72a32813-5425-4508-a502-fa64181f70ac",
        "70e1b367-e52b-42bb-aa1e-2539b62467c7",
        "6e347397-fe03-40a1-8d0b-db6b589b78ef",
        "6d00bd04-481d-4a7b-9c49-71c5d28d06ee",
        "6ba87768-7ff1-489f-a53b-1b07998a49fb",
        "6b5caf91-9982-48f8-9935-b5e38c2e8e42",
        "6ae599a4-b2cd-4139-a751-665ad269486e",
        "6992ffe7-602d-4a04-b745-51eeb9106d2d",
        "697d17cd-37f3-41db-870f-8269da797a9e",
        "6723a9f2-5e94-43e5-bc62-52fb16cd03ae",
        "6716d162-2536-461e-a873-97485712025d",
        "6488aa6a-a665-4da9-bb29-3adf0ea8841e",
        "64767f54-7d1f-4f42-b714-2602ce067ba6",
        "6416a791-fd93-4016-8c16-b74d5c2a432d",
        "63ec02f6-6cd5-44b3-af83-f5692d2fbe8f",
        "63ce4318-18d4-4788-b472-d21640de0cfe",
        "62bf8c18-505f-458f-b827-16c16ce2fd4f",
        "628a084d-92f4-4e7e-b6dd-e71cf712f2b5",
        "61b54dbe-0f3e-44bf-867d-c62806325193",
        "6060469f-f5d1-4bc1-859c-be9ab5eab75f",
        "6011523e-53d9-4e91-8a54-44cca3d78a24",
        "5fbadf65-129c-446c-9344-be0c32371500",
        "5eb619d4-1950-493f-9bde-d36bd54bbb9b",
        "5e83bd08-5426-4a99-8686-8f847699d844",
        "5c9c8892-5a7f-458e-894e-243787bc442f",
        "5b99f463-1f2b-4776-87e8-976aca49721d",
        "5af0bd27-9c0b-4f4e-a88d-6ac97cb1d76e",
        "59c186fa-f1c9-4d44-93e5-3b4caf029998",
        "59b8ba8a-4a0d-454b-b844-002bf4f7739f",
        "58473724-3f05-4f89-9805-de0a289625db",
        "56ab1049-0dc1-4233-aaea-3193394e1c23",
        "5584560d-0fba-4112-9692-6bcca5a09ede",
        "54f6568f-e62e-40cf-9a62-02409c5abce4",
        "54e968b2-28bb-49d0-b47f-c58fed43408c",
        "536e6868-23b7-4f40-bab0-7f869b36c087",
        "52caab05-ae0a-4501-a10b-1bbf6743c720",
        "520947ea-dc4b-497e-aba3-b642c57b4bea",
        "5161bb7f-0113-461d-b82d-67ea0a8148a2",
        "50f97415-73c6-4260-a87c-dc7dd289c07b",
        "4d853e5f-8946-4cea-b368-f89c94796b8f",
        "4a9ff5cc-63cc-4490-ad2e-364ea08438ed",
        "4a7334d9-24d3-48bd-833c-669dc3a82e07",
        "49416e27-f847-44dc-969b-90c3ef9ffa1e",
        "47c46cfe-5715-46d9-8143-350f3c972a67",
        "468d48ea-68f2-4df8-bf34-bae35ce0b6da",
        "457d8519-9463-4433-b65a-ec4ccd6aea69",
        "44c9ae94-46d3-41e0-81ab-6e59a5f7b908",
        "420cfc4a-d7bd-43f6-81a4-9b1fabe1e9f0",
        "3d288700-9802-4e29-bd66-b18ffd612819",
        "3bb9adc0-2a49-43a7-b751-a4aa08a324b9",
        "396ee740-efca-4870-a4e5-01182a0d7678",
        "3895d208-ddea-414d-8cbb-7824c83aad5b",
        "36e856ec-8acc-4f0a-ae52-edafd212eaa2",
        "36453a3f-0bbd-40cb-81ba-331776b86dfd",
        "3605be58-0f75-4226-931b-4708d3dbeaf2",
        "34297ced-bcbd-4bf6-89f0-baa8a4579587",
        "33df9f25-060b-4adf-a1bc-aad3ad8d48ac",
        "33935146-6607-49ff-bd2f-acf781abcbbb",
        "2ea0209e-74e8-4dd1-926c-494fb5b22b2e",
        "2dc7fc43-7147-4170-854a-817177540cad",
        "2c237873-7c78-4f2e-8926-3ffd94a848ce",
        "2bae2373-fd1b-4ec9-9cee-76ad3fe1ee54",
        "2b705932-824e-48a1-aed1-1cde39013802",
        "26dc3d14-9d1a-41dc-adfd-ed925c1fb4b5",
        "2485e0ae-7223-4a55-bc24-e51e4e35cf5d",
        "23c4e62f-95d2-43e4-bd60-dd84f988d92d",
        "20929628-bd49-4dc9-be5a-23fd9c8b2da8",
        "1f7e9eac-452c-476f-b1ac-0f63ff248cc2",
        "1a714fa8-0191-4c08-b855-1fc798ad35d4",
        "16185709-bede-4058-9745-a81d45be303d",
        "15c56e2c-6694-4825-8f44-df19e98ae37b",
        "153b11fc-aa68-4450-a279-fb0e415577ed",
        "15114064-f7bc-454f-9e55-f62c33a3510a",
        "0f68b802-b37b-44fe-ba65-d02f38cd2ee1",
        "0bff86ac-ff97-4b5c-842c-db8fb1d327d1",
        "0bfdca73-15ff-4859-bf24-405d42034971",
        "0bc7e6d1-e769-4009-9363-32edb294ccc4",
        "0876be69-49aa-4c13-92b3-5853cc83be8d",
        "0457901e-7a94-4110-b3f3-2b1b9c3f3adb",
        "03d617a9-d01d-4520-83fb-870ac01a4971",
        "03318ab3-875c-4b5b-bd46-f0d3e05f92b2",
        "02e01a42-f8bc-444a-b876-add899dd1190",
        "023e0bdd-82f6-4503-8c93-852f5470145a",
        "0215b5d5-d702-4f0e-b3e6-574e0d5cb16d",
        "01e0755d-7b6e-423d-820b-7e3e3e5b8b7a",
        "007ff3e0-9b1e-4dff-894a-ea19b0a5ce23",
        "00158355-c29b-4967-8bfc-e352a4f3f2d9",
    )
